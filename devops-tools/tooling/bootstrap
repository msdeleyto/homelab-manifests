#!/bin/bash

set -eu

# Add helm repository for argocd
helm repo add argo https://argoproj.github.io/argo-helm && \
  helm repo update

# Install CRDs
kubectl apply --server-side -k https://github.com/argoproj/argo-cd/manifests/crds\?ref\=stable

kubectl create namespace devops-tools || true

kubectl kustomize --enable-helm "${argocd_dir}" | envsubst "${INFRA_DOMAIN} ${ENV}" | kubectl apply --wait -f -

echo -e "Done!\n"
